<!DOCTYPE HTML>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>KSX - 个人博客</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Free HTML5 Website Template by GetTemplates.co" />
	<meta name="keywords" content="free website templates, free html5, free template, free bootstrap, free website template, html5, css3, mobile first, responsive" />

	<link href="../../favicon.ico" rel="icon" type="image/x-icon" />
	<link href="https://fonts.googleapis.com/css?family=Crimson+Text:400,400i|Roboto+Mono" rel="stylesheet">
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="../../css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="../../css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="../../css/bootstrap.css">

	<!-- Magnific Popup -->
	<link rel="stylesheet" href="../../css/magnific-popup.css">

	<!-- Theme style  -->
	<link rel="stylesheet" href="../../css/style.css">

	<!-- Modernizr JS -->
	<script src="../../js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	</head>
	<body>
		
	<div class="gtco-loader"></div>
	
	<div id="page">
	<nav class="gtco-nav" role="navigation">
		<div class="container">
			<div class="row">
				<div class="col-xs-2 text-left">
					<div id="gtco-logo"><a href="index.html">KSX<span>.</span></a></div>
				</div>
				<div class="col-xs-10 text-right menu-1">
					<ul>
						<li><a href="../../index.html" style="font-size:14px;">首页</a></li>
						<li><a href="../../category.html" style="font-size:14px;">分类</a></li>
						<li class="has-dropdown">
							<a style="font-size:14px;">API</a>
							<ul class="dropdown">
								<li><a href="" target="_blank">API docs</a></li>
								<li><a href="" target="_blank">Git</a></li>
								<li><a href="" target="_blank">Pro Git</a></li>
								<li><a href="" target="_blank">JavaAPI</a></li>
								<li><a href="" target="_blank">Hibernate</a></li>
								<li><a href="" target="_blank">Spring</a></li>
								<li><a href="" target="_blank">MyBatis</a></li>
								<li><a href="" target="_blank">Activiti</a></li>
								<li><a href="" target="_blank">JQuery</a></li>
								<li><a href="" target="_blank">EasyUI</a></li>
								<li><a href="" target="_blank">Bootstrap</a></li>
								<li><a href="" target="_blank">Markdown</a></li>
								<li><a href="" target="_blank">前端开发规范手册</a></li>
								<li><a href="" target="_blank">JavaScript</a></li>
								<li><a href="" target="_blank">HTML</a></li>
								<li><a href="" target="_blank">CSS</a></li>
								<li><a href="" target="_blank">RGB</a></li>
							</ul>
						</li>
						<li class="has-dropdown">
							<a style="font-size:14px;">PDF</a>
							<ul class="dropdown">
								<li><a href="" target="_blank">PDF Book</a></li>
								<li><a href="" target="_blank">Pro Git </a></li>
								<li><a href="" target="_blank">Git权威指南</a></li>
								<li><a href="" target="_blank">JavaScript权威指南</a></li>
								<li><a href="" target="_blank">jQuery实战</a></li>
								<li><a href="" target="_blank">MyBatis3用户指南</a></li>
								<li><a href="" target="_blank">IBATIS2.0开发指南</a></li>
								<li><a href="" target="_blank">HTML精选属性</a></li>
								<li><a href="" target="_blank">JDBC学习手册</a></li>
								<li><a href="" target="_blank">程序员跳槽全攻略</a></li>
								<li><a href="" target="_blank">Java程序员面试宝典</a></li>
								<li><a href="" target="_blank">Java并发编程的艺术</a></li>
								<li><a href="" target="_blank">软件随想录</a></li>
								<li><a href="" target="_blank">Java面试题</a></li>
							</ul>
						</li>
						<li><a href="http://blog.csdn.net/kesixin" target="_blank" style="font-size:14px;">CSDN</a></li>
						<li><a href="http://www.jianshu.com/u/ed95b64d8305" target="_blank" style="font-size:14px;">简书</a></li>
						<li><a style="font-size:14px;">历程</a></li>
						<li><a style="font-size:14px;">关于</a></li>
					</ul>
				</div>
			</div>
			
		</div>
	</nav>

	<header id="gtco-header" class="gtco-cover" role="banner" style="background-image:url(../../images/img_7.jpg);background-position:0px;" data-stellar-background-ratio="0.5">
		<div class="overlay"></div>
		<div class="container">
			<div class="row">
				<div class="col-md-7 text-left">
					<div class="display-t">
						<div class="display-tc animate-box" data-animate-effect="fadeInUp">
							<span class="date-post">2017-09-01</span>
							<h1 class="mb30"><a href="#">Linux系统Apache2.4+Tomcat7.0整合配置</a></h1>
						</div>
					</div>
				</div>
			</div>
		</div>
	</header>
	
	<div id="gtco-maine">
		<div class="container">
			<div class="row row-pb-md">
				<div class="col-md-12">
					<article class="mt-negative">
						<div class="text-left content-article">
							<div class="row">
								<div class="col-lg-8 cp-r animate-box">
									
<h2 id="一安装apache">一、安装Apache</h2>

<p>之前发的博文有关于安装和配置Apache服务器。 <br>
<a href="http://blog.csdn.net/kesixin/article/details/72882469"  target="_block">csdn</a> <br>
<a href="http://www.jianshu.com/p/c3617cc31561" target="_block">简书</a></p>



<h2 id="二tomcat的安装配置">二、Tomcat的安装配置</h2>

<p>1、下载对应的jdk,并配置java环境，我下载的版本是jdk-8u144-linux-x64.rpm。 <br>
<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_block">JDK下载地址</a></p>

<p>下载Tomcat的安装包，我下载的版本是apache-tomcat-7.0.81。 <br>
<a href="http://tomcat.apache.org/" target="_block">Tomcat官网下载</a></p>

<p>2、安装jdk</p>

<ul>
<li>下载后，首先把jdk-8u144-linux-x64.rpm复制到/usr/local</li>
</ul>



<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-variable">#cp</span> jdk<span class="hljs-subst">-</span><span class="hljs-number">8</span>u144<span class="hljs-attribute">-linux</span><span class="hljs-attribute">-x64</span><span class="hljs-built_in">.</span>rpm /usr/<span class="hljs-built_in">local</span></code></pre>

<ul>
<li>给所有用户添加可执行权限</li>
</ul>



<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-variable">#chmod</span> <span class="hljs-subst">+</span>x jdk<span class="hljs-subst">-</span><span class="hljs-number">8</span>u144<span class="hljs-attribute">-linux</span><span class="hljs-attribute">-x64</span><span class="hljs-built_in">.</span>rpm</code></pre>

<ul>
<li>开始安装程序</li>
</ul>



<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-variable">#rpm</span> <span class="hljs-attribute">-ivh</span> jdk<span class="hljs-subst">-</span><span class="hljs-number">8</span>u144<span class="hljs-attribute">-linux</span><span class="hljs-attribute">-x64</span><span class="hljs-built_in">.</span>rpm</code></pre>

<ul>
<li>安装结束后，jdk会安装在/usr/java里，然后配置环境变量，在 /etc/profile 中加入以下内容：</li>
</ul>



<pre class="prettyprint"><code class=" hljs bash"><span class="hljs-comment"># vi /etc/profile      //进入profile文件加入以下内容：</span>

<span class="hljs-keyword">export</span> JAVA_HOME=/usr/java/jdk1.<span class="hljs-number">8.0</span>_144  
<span class="hljs-keyword">export</span> JRE_HOME=/usr/java/jdk1.<span class="hljs-number">8.0</span>_144/jre  
<span class="hljs-keyword">export</span>CLASSPATH=.:<span class="hljs-variable">$JAVA_HOME</span>/lib/dt.jar:<span class="hljs-variable">$JAVA_HOME</span>/lib/tools.jar:<span class="hljs-variable">$JRE_HOME</span>/lib  
<span class="hljs-keyword">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin  

<span class="hljs-comment"># source /etc/profile   //使配置生效</span>

<span class="hljs-comment"># java -version   //测试jdk是否安装成功</span></code></pre>

<p><img src="http://upload-images.jianshu.io/upload_images/6673460-d0abf9a09a8e2098.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="" class="img-responsive"></p>

<p>3、Tomcat的安装</p>

<ul>
<li>解压安装包</li>
</ul>



<pre class="prettyprint"><code class=" hljs vala"><span class="hljs-preprocessor"># mkdir /usr/local/tomcat</span>
<span class="hljs-preprocessor"># cd /usr/local/tomcat</span>
<span class="hljs-preprocessor"># tar -zxvf /software/apache-tomcat-7.0.81.tar.gz</span></code></pre>

<ul>
<li>启动Tomcat</li>
</ul>



<pre class="prettyprint"><code class=" hljs bash"> <span class="hljs-comment"># cd /usr/local/tomcat/bin</span>
 <span class="hljs-comment"># ./startup.sh</span></code></pre>

<p><img src="http://upload-images.jianshu.io/upload_images/6673460-4480d49f1c5a91f3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="" class="img-responsive"></p>

<ul>
<li>如果出现  ” Using_JRE_HOME：/usr/   “这种情况的，那可能是没有执行 ” #  source /etc/profile “这句命令。 <br>
或者可以在” /usr/local/apache-tomcat-7.0.81/bin “文件夹下的setclasspath.sh文件的开头加入下面的内容：</li>
</ul>



<pre class="prettyprint"><code class=" hljs bash"><span class="hljs-keyword">export</span> JAVA_HOME=/usr/java/jdk1.<span class="hljs-number">8.0</span>_144  
<span class="hljs-keyword">export</span> JRE_HOME=/usr/java/jdk1.<span class="hljs-number">8.0</span>_144/jre</code></pre>

<ul>
<li>打开防火墙,使外部能访问</li>
</ul>



<pre class="prettyprint"><code class=" hljs bash"> <span class="hljs-comment"># /sbin/iptables -I INPUT -p tcp --dport 8080 -j ACCEPT</span>
 <span class="hljs-comment"># service iptables save</span>
 <span class="hljs-comment"># service iptables restart</span></code></pre>

<ul>
<li>如果是阿里云的ecs服务器可以配置添加安全组规则，</li>
</ul>
 
<p><img src="http://upload-images.jianshu.io/upload_images/6673460-0b473912636332b8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="" class="img-responsive"></p>
 
<p><img src="http://upload-images.jianshu.io/upload_images/6673460-261eb1464b8b3794.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="" class="img-responsive"></p>



<h2 id="三编译生成modjkso文件">三、编译生成mod_jk.so文件</h2>

<p>1、下载tomcat-conntector压缩包，我下载的版本是tomcat-connectors-1.2.42-src.tar.gz，这个要跟安装的Apache版本匹配，我的Apache服务器版本是Apache/2.4.6。 <br>
<a href="http://tomcat.apache.org/download-connectors.cgi" target="_block">官网下载地址</a></p>

<p>2、下载后，首先把tomcat-connectors-1.2.42-src.tar.gz复制到/usr/local</p>



<pre class="prettyprint"><code class=" hljs vala"><span class="hljs-preprocessor"># cp tomcat-connectors-1.2.42-src.tar.gz /usr/local</span></code></pre>

<ul>
<li>解压</li>
</ul>



<pre class="prettyprint"><code class=" hljs vala"><span class="hljs-preprocessor"># tar -xzvf tomcat-connectors-1.2.42-src.tar.gz /usr/local</span></code></pre>

<ul>
<li>解压后，进入native文件夹</li>
</ul>



<pre class="prettyprint"><code class=" hljs vala"><span class="hljs-preprocessor"># cd /usr/local/tomcat-connectors-1.2.42-src/native</span>
<span class="hljs-preprocessor"># ./configure --with-apxs=/usr/bin/apxs(此处apxs地址可能不一样，可用命令" whereis apxs "来查看)</span>
<span class="hljs-preprocessor"># make</span></code></pre>

<ul>
<li>完成编译后，在/usr/local/tomcat-connectors-1.2.42-src/native/apache-2.0文件夹下可以找到mod_jk.so文件。将这个文件复制到apache安装路径下的modules文件夹下，我是用yum安装的，所以我的apache默认安装路径是/usr/lib64/httpd。到这里也就完成了编译的步骤。</li>
</ul>

<p>3、问题：在编译mod_jk.so文件的时候，我遇到了找不到apxs文件，所以编译不了，apxs是一个为Apache HTTP服务器编译和安装扩展模块的工具，用于编译一个或多个源程序或目标代码文件为动态共享对象，使之可以用由mod_so提供的LoadModule指令在运行时加载到Apache服务器中。</p>

<p>（1） 检查 apxs 有没有安装。” # whereis apxs ” <br>
（2） 如果没有的话，先安装apxs</p>



<pre class="prettyprint"><code class=" hljs vala"><span class="hljs-preprocessor"># cd /etc/</span>
<span class="hljs-preprocessor"># vi yum.conf</span>
<span class="hljs-comment">// 如果有关于 apache or httpd 的 "exclude"这样一行，把它注释掉；如果没有，就直接退出就行</span>
<span class="hljs-comment">// 保存并退出</span>
<span class="hljs-preprocessor"># yum install apr-util-devel</span>
<span class="hljs-preprocessor"># yum install httpd-devel</span>
<span class="hljs-preprocessor"># whereis apxs</span>
<span class="hljs-comment">// 做完这几步以后，你就应该有 "/usr/bin/apxs" 这个文件了。</span>
</code></pre>



<h2 id="四整合apache和tomcat">四、整合Apache和Tomcat</h2>

<p>1、创建相关配置文件 <br>
* 进入apache安装路径下的conf文件夹，创建两个文件，mod_jk.conf以及workers.properties。</p>

<p>mod_jk.conf 内容如下：</p>



<pre class="prettyprint"><code class=" hljs perl"><span class="hljs-comment">#LoadModule jk_module modules/mod_jk.so  </span>

JkWorkersFile /etc/httpd/conf/workers.properties  
<span class="hljs-comment"># Where to put jk logs  </span>
JkLogFile /var/<span class="hljs-keyword">log</span>/httpd/mod_jk.<span class="hljs-keyword">log</span>  

<span class="hljs-comment"># Set the jk log level [debug/error/info]  </span>
JkLogLevel info  

<span class="hljs-comment"># Select the log format  </span>
JkLogStampFormat <span class="hljs-string">"[<span class="hljs-variable">%a</span> <span class="hljs-variable">%b</span> <span class="hljs-variable">%d</span> <span class="hljs-variable">%H</span>:<span class="hljs-variable">%M</span>:<span class="hljs-variable">%S</span> <span class="hljs-variable">%Y</span>]"</span>  

<span class="hljs-comment"># JkOptions indicate to send SSL KEY SIZE,   </span>
JkOptions +ForwardKeySize +ForwardURICompat -ForwardDirectories  
<span class="hljs-comment"># JkRequestLogFormat set the request format   </span>
JkRequestLogFormat <span class="hljs-string">"<span class="hljs-variable">%w</span> <span class="hljs-variable">%V</span> <span class="hljs-variable">%T</span>"</span>  

JkMount /<span class="hljs-variable">*/</span>servlet/*  worker1  
JkMount /<span class="hljs-variable">*.</span>jsp worker1  
JkMount /application/* worker1  
JkMount /<span class="hljs-variable">*.</span><span class="hljs-keyword">do</span> worker1  
JkMount /<span class="hljs-variable">*.</span>class worker1  
JkMount /<span class="hljs-variable">*.</span>jar worker1  </code></pre>

<ul>
<li>其中，前两个参数（JkWorkerFile和JkLogFile）具体的值会因为apache安装路径的不同而不同，此处需写入自己的apache服务器的路径。 <br>
文件末尾的几行JkMount意思是将符合条件的文件交给Tomcat处理。中间则是一些常规参数的设置。</li>
</ul>

<p>workers.properties内容如下</p>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-preprocessor"># Defining a worker named worker1 and of type ajp13  </span>
worker<span class="hljs-preprocessor">.list</span>=worker1  

<span class="hljs-preprocessor"># Set properties for worker1  </span>
worker<span class="hljs-preprocessor">.worker</span>1<span class="hljs-preprocessor">.type</span>=ajp13    
worker<span class="hljs-preprocessor">.worker</span>1<span class="hljs-preprocessor">.host</span>=localhost    
worker<span class="hljs-preprocessor">.worker</span>1<span class="hljs-preprocessor">.port</span>=<span class="hljs-number">8009</span>  
worker<span class="hljs-preprocessor">.worker</span>1<span class="hljs-preprocessor">.lbfactor</span>=<span class="hljs-number">50</span>    
worker<span class="hljs-preprocessor">.worker</span>1<span class="hljs-preprocessor">.cachesize</span>=<span class="hljs-number">10</span>    
worker<span class="hljs-preprocessor">.worker</span>1<span class="hljs-preprocessor">.cache</span>_timeout=<span class="hljs-number">600</span>    
worker<span class="hljs-preprocessor">.worker</span>1<span class="hljs-preprocessor">.socket</span>_keepalive=<span class="hljs-number">1</span>    
worker<span class="hljs-preprocessor">.worker</span>1<span class="hljs-preprocessor">.socket</span>_timeout=<span class="hljs-number">300</span></code></pre>

<ul>
<li>接着是对/conf文件夹下自带的httpd.conf文件加入如下内容：</li>
</ul>



<pre class="prettyprint"><code class=" hljs apache"><span class="hljs-keyword"><span class="hljs-common">LoadModule</span></span> jk_module modules/mod_jk.so
<span class="hljs-keyword">Include</span> /etc/httpd/conf/mod_jk.conf
<span class="hljs-tag">&lt;VirtualHost *:80&gt;</span>
     <span class="hljs-keyword"><span class="hljs-common">DocumentRoot</span></span> <span class="hljs-string">"/usr/local/apache-tomcat-7.0.81/webapps/test"</span>
     <span class="hljs-keyword">JkMount</span> /* worker1
<span class="hljs-tag">&lt;/VirtualHost&gt;</span></code></pre>

<ul>
<li><p>保存之后重启Apache和Tomcat。</p></li>
<li><p>如果出现Apache启动报错，那可能是mod_jk.so文件的版本跟Apache版本不符合，需要重新下载，编译。</p></li>
</ul>

<p>测试成功： <br>
<img src="http://upload-images.jianshu.io/upload_images/6673460-d094c61ab287b161.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="" class="img-responsive"></p>
								</div>
								<div class="col-lg-4 animate-box">
									<div class="gtco-highlight right">
										<h4>点点滴滴</h4>
										<p style="font-size:15px;">今天是9月1號了，又開學了，中午跟同事一起去附近一個大學的食堂吃飯，看見了好多學生，走在食堂裏總有種格格不入的感覺，感歎之余，發現自己已不再是學生了。大學時光多麽美好啊，逝去的時光，留下了美好的回憶。感慨發完，繼續來寫Apache2.4+Tomcat7.0整合配置。</p>
									</div>
								</div>
							</div>
													
						</div>
					</article>
				</div>
			</div>
		</div>
	</div>



	<footer id="gtco-footer" role="contentinfo" style="padding:0;">
		<div class="container">
			<div class="row copyright">
				<div class="col-md-12 text-center">
					<p>
						 <span style="font-size:16px;">©</span>2017 版权所有 ICP证：<a href="http://www.miitbeian.gov.cn/" target="_block" style="color:#666666">粤ICP备17112246号</a>
					</p>
				</div>
			</div>

		</div>
	</footer>
	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="icon-arrow-up"></i></a>
	</div>
	
	<!-- jQuery -->
	<script src="../../js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="../../js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="../../js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="../../js/jquery.waypoints.min.js"></script>
	<!-- Stellar -->
	<script src="../../js/jquery.stellar.min.js"></script>
	<!-- Main -->
	<script src="../../js/main.js"></script>

	</body>
</html>

