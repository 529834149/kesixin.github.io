<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>KSX - 个人博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Free HTML5 Website Template by GetTemplates.co" />
    <meta name="keywords" content="free website templates, free html5, free template, free bootstrap, free website template, html5, css3, mobile first, responsive" />

    <link href="../../favicon.ico" rel="icon" type="image/x-icon" />
    <link href="https://fonts.googleapis.com/css?family=Crimson+Text:400,400i|Roboto+Mono" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="../../css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="../../css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="../../css/bootstrap.css">

    <!-- Magnific Popup -->
    <link rel="stylesheet" href="../../css/magnific-popup.css">

    <!-- Theme style  -->
    <link rel="stylesheet" href="../../css/style.css">

    <!-- Modernizr JS -->
    <script src="../../js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="js/respond.min.js"></script>
    <![endif]-->

</head>
<body>

<div class="gtco-loader"></div>

<div id="page">
    <nav class="gtco-nav" role="navigation">
        <div class="container">
            <div class="row">
                <div class="col-xs-2 text-left">
                    <div id="gtco-logo"><a href="index.html">KSX<span>.</span></a></div>
                </div>
                <div class="col-xs-10 text-right menu-1">
                    <ul>
                        <li><a href="../../index.html" style="font-size:16px;font-weight: bold;">首页</a></li>
                        <li class="active"><a href="../../archive.html" style="font-size:16px;font-weight: bold;">归档</a></li>
                        <li><a href="../../category.html" style="font-size:16px;font-weight: bold;">分类</a></li>
                        <li class="has-dropdown">
                            <a style="font-size:16px;font-weight: bold;">API</a>
                            <ul class="dropdown">
                                <li><a href="http://itmyhome.com/git/" target="_blank">Git</a></li>
                                <li><a href="http://itmyhome.com/progit/" target="_blank">Pro Git</a></li>
                                <li><a href="http://itmyhome.com/jq/" target="_blank">JQuery</a></li>
                                <li><a href="http://itmyhome.com/easyui/" target="_blank">EasyUI</a></li>
                                <li><a href="http://itmyhome.com/bootstrap/" target="_blank">Bootstrap</a></li>
                                <li><a href="http://itmyhome.com/markdown/" target="_blank">Markdown</a></li>
                                <li><a href="http://itmyhome.com/front/" target="_blank">前端开发规范手册</a></li>
                                <li><a href="http://itmyhome.com/js/" target="_blank">JavaScript</a></li>
                                <li><a href="http://itmyhome.com/html/" target="_blank">HTML</a></li>
                                <li><a href="http://itmyhome.com/css/" target="_blank">CSS</a></li>
                                <li><a href="http://itmyhome.com/rgb/" target="_blank">RGB</a></li>
                            </ul>
                        </li>
                        <li class="has-dropdown">
                            <a style="font-size:16px;font-weight: bold;">PDF</a>
                            <ul class="dropdown">
                                <li><a href="http://itmyhome.com/progit-pdf/" target="_blank">Pro Git </a></li>
                                <li><a href="http://itmyhome.com/the-definitive-guide-of-git-pdf/" target="_blank">Git权威指南</a></li>
                                <li><a href="http://itmyhome.com/javascript-pdf/" target="_blank">JavaScript权威指南</a></li>
                                <li><a href="http://itmyhome.com/jquery-in-action-pdf/" target="_blank">jQuery实战</a></li>
                                <li><a href="http://itmyhome.com/mybatis-pdf/" target="_blank">MyBatis3用户指南</a></li>
                                <li><a href="http://itmyhome.com/ibatis-pdf/" target="_blank">IBATIS2.0开发指南</a></li>
                                <li><a href="http://itmyhome.com/html-pdf/" target="_blank">HTML精选属性</a></li>
                                <li><a href="http://itmyhome.com/jdbc-pdf/" target="_blank">JDBC学习手册</a></li>
                                <li><a href="http://itmyhome.com/programmer-job-hopping-pdf/" target="_blank">程序员跳槽全攻略</a></li>
                                <li><a href="http://itmyhome.com/software-random-thoughts-pdf/" target="_blank">软件随想录</a></li>
                            </ul>
                        </li>
                        <li><a href="http://blog.csdn.net/kesixin" target="_blank" style="font-size:16px;font-weight: bold;">CSDN</a></li>
                        <li><a href="http://www.jianshu.com/u/ed95b64d8305" target="_blank" style="font-size:16px;font-weight: bold;">简书</a></li>
                        <li><a href="../../history.html" style="font-size:16px;font-weight: bold;">历程</a></li>
                        <li><a href="../../history.html" style="font-size:16px;font-weight: bold;">关于</a></li>
                    </ul>
                </div>
            </div>

        </div>
    </nav>

    <header id="gtco-header" class="gtco-cover" role="banner" style="background-image:url(../../images/img_7.jpg);background-position:0px;" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-7 text-left">
                    <div class="display-t">
                        <div class="display-tc animate-box" data-animate-effect="fadeInUp">
                            <span class="date-post">2017-06-10</span>
                            <h1 class="mb30"><a href="#">ThinkPHP 解决使用uploadify 在Firefox浏览器上传图片出现HTTP 302报错</a></h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div id="gtco-maine">
        <div class="container">
            <div class="row row-pb-md">
                <div class="col-md-12">
                    <article class="mt-negative">
                        <div class="text-left content-article">
                            <div class="row">
                                <div class="col-lg-8 cp-r animate-box">
                                    <p>一、uploadify使用详解</p>

                                    <p>1.在html中的file标签可以用来上传文件，但是在文件较大或者多文件上传的时候，file标签就不太适合了。而uploadify插件是基于js的jquery库写的，结合ajax和flash，实现多文件上传功能。</p>

                                    <p>2.主要文件： <br>
                                        jquery.uploadify.js （主要插件） <br>
                                        jquery-1.7.2.min.js （jquery主件） <br>
                                        uploadify.swf （flash上传插件） <br>
                                        uploadify.css （上传样式表） <br>
                                        uploadify-cancel.png （flash上传按钮图标） <br>
                                        uploadify.php （上传处理数据） <br>
                                        uploads文件夹 （默认保存上传文件目录）</p>

                                    <p>3.在上传的页面引入js/css文件，然后初始化一些参数变量</p>



                                    <pre class="prettyprint"><code class=" hljs javascript">$(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            $(<span class="hljs-string">'#file_upload'</span>).uploadify({
                buttonText:<span class="hljs-string">'选择文件'</span>,
                swf: <span class="hljs-string">'{$smarty.const.SITE_PUBLIC_URL}Admin/uploadify/uploadify.swf'</span>,
                uploader: <span class="hljs-string">'{$smarty.const.__CONTROLLER__}/Upload'</span>,
                method:<span class="hljs-string">'get'</span>,
                onSWFReady:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
                    $(<span class="hljs-string">'#file_upload'</span>).uploadify(<span class="hljs-string">'disable'</span>, <span class="hljs-literal">true</span>);

                },
                onUploadStart:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(file)</span>{</span>
                    <span class="hljs-keyword">var</span> spot=$(<span class="hljs-string">'#spot'</span>).val();
                    <span class="hljs-keyword">var</span> coid={$arrData[<span class="hljs-string">'coid'</span>]};
                    <span class="hljs-keyword">var</span> session_id={$smarty.session.session_id};
                    $(<span class="hljs-string">"#file_upload"</span>).uploadify(<span class="hljs-string">"settings"</span>, <span class="hljs-string">"formData"</span>, { <span class="hljs-string">'spot'</span> : spot,<span class="hljs-string">'coid'</span>:coid,<span class="hljs-string">'session_id'</span>:session_id});
                },
                onUploadSuccess:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(file, data, response)</span>{</span>
                }
            });
  }); </code></pre>

                                    <p>接着就是在body里面添加调用标签</p>



                                    <pre class="prettyprint"><code class=" hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">i</span>&gt;</span>多图上传<span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"must"</span>&gt;</span>*<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>&gt;</span>&amp;nbsp;
 <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"file_upload"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"file_upload"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"file"</span> <span class="hljs-attribute">multiple</span>=<span class="hljs-value">"true"</span>&gt;</span></code></pre>

                                    <p>最后就是在后台处理上传的文件。。。。。。</p>

                                    <p><a href="http://www.cnblogs.com/yangy608/p/3915349.html" target="_blank">Uploadify 参数说明</a></p>

                                    <p>二、出现的问题</p>

                                    <p>1.由于jquery uploadify是借助flash来实现上传的，所以可能在浏览器禁止网站运行flash是会出现如下这个情况：</p>

                                    <p><img src="http://img.blog.csdn.net/20170610202253499?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VzaXhpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" class="img-responsive"></p>

                                    <p>这时就要去浏览器设置，</p>

                                    <p><img src="http://img.blog.csdn.net/20170610202334171?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VzaXhpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" class="img-responsive"></p>

                                    <p><img src="http://img.blog.csdn.net/20170610202352402?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VzaXhpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" class="img-responsive"></p>

                                    <p>正常的情况：</p>

                                    <p><img src="http://img.blog.csdn.net/20170610202429497?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VzaXhpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" class="img-responsive"></p>

                                    <p>2.Jquery Uploadify在IE浏览器可以正常上传，在Chrome浏览器使用也是正常的，只有在Firefox浏览器使用才会出现HTTP 302报错。</p>

                                    <p><img src="http://img.blog.csdn.net/20170610202507654?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VzaXhpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" class="img-responsive"></p>

                                    <p>在实现异步上传的时候，每一个文件在上传时都会提交给服务器一个请求。每个请求都需要安全验证，session和cookie的校验。由于jquery uploadify是借助flash来实现上传的，每一次向后台发送数据流请求时，IE会自动把本地cookie存储捆绑在一起发送给服务器。但是firefox不会这样做，所以在进行验证登录的时候就出现了HTTP 302 报错。如果把这个模块放在不需要验证的地方是不会出现这种报错的。</p>

                                    <p>Session又称为会话状态，是Web系统中最常用的状态，用于维护和当前浏览器实例相关的一些信息。Session对于每一个客户端是不一样的，用户首次与Web服务器建立连接的时候，服务器会给用户分发一个 SessionID作为标识。SessionID是一个由24个字符组成的随机字符串。用户每次提交页面，浏览器都会把这个SessionID包含在 HTTP头中提交给Web服务器，这样Web服务器就能区分当前请求页面的是哪一个客户端。</p>

                                    <p>三.解决问题</p>

                                    <p>1.解决方案一：</p>

                                    <p>在插件初始化的时候，把本地记录下来的session值，以及身份验证值传给初始化方法，进行参数赋值，这样，每次异步请求上传文件的时候，相应的 session值就包含在请求文件中了。</p>



                                    <pre class="prettyprint"><code class=" hljs javascript">onUploadStart:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(file)</span>{</span>
      <span class="hljs-keyword">var</span> spot=$(<span class="hljs-string">'#spot'</span>).val();
      <span class="hljs-keyword">var</span> coid={$arrData[<span class="hljs-string">'coid'</span>]};
      <span class="hljs-keyword">var</span> session_id={$smarty.session.session_id};
      $(<span class="hljs-string">"#file_upload"</span>).uploadify(<span class="hljs-string">"settings"</span>, <span class="hljs-string">"formData"</span>, {<span class="hljs-string">'spot'</span> : spot,<span class="hljs-string">'coid'</span>:coid,<span class="hljs-string">'session_id'</span>:session_id});
                },</code></pre>

                                    <p>服务器端（ThinkPHP控制器）代码</p>



                                    <pre class="prettyprint"><code class=" hljs php"><span class="hljs-keyword">public</span>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_initialize</span><span class="hljs-params">()</span>{</span>
     <span class="hljs-comment">//此处为解决Uploadify在火狐下出现http 302错误 重新设置SESSION</span>
    <span class="hljs-variable">$session_name</span>= session_name();
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'session_id'</span>]))
     {
        session_id(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'session_id'</span>]);
        session_start();
      }
       <span class="hljs-comment">//执行登陆验证检测函数</span>
      <span class="hljs-variable">$this</span>-&gt;powerverify();
 }</code></pre>

                                    <p>2.解决方案二：</p>



                                    <pre class="prettyprint"><code class=" hljs javascript">onUploadStart:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(file)</span>{</span>
      <span class="hljs-keyword">var</span> spot=$(<span class="hljs-string">'#spot'</span>).val();
      <span class="hljs-keyword">var</span> coid={$arrData[<span class="hljs-string">'coid'</span>]};
      <span class="hljs-keyword">var</span> session_id={$smarty.session.session_id};
      $(<span class="hljs-string">"#file_upload"</span>).uploadify(<span class="hljs-string">"settings"</span>, <span class="hljs-string">"formData"</span>, {<span class="hljs-string">'spot'</span> : spot,<span class="hljs-string">'coid'</span>:coid,<span class="hljs-string">'session_id'</span>:session_id});
                },</code></pre>

                                    <p>服务器端（ThinkPHP控制器）代码</p>

                                    <p>在核心类文件夹里下的Conf/convention.PHP中 将 VAR_SESSION_ID打开(建议在模块的conf文件中添加配置，如在模块下的Conf/config.php中添加 ‘VAR_SESSION_ID’ =&gt; ‘session_id’,)</p>



                                    <pre class="prettyprint"><code class=" hljs xml"><span class="php"><span class="hljs-preprocessor">&lt;?php</span>

<span class="hljs-keyword">return</span> <span class="hljs-keyword">array</span>(

    <span class="hljs-string">'VAR_SESSION_ID'</span> =&gt; <span class="hljs-string">'session_id'</span>,<span class="hljs-comment">//sessionID的提交变量</span>

);
</span></code></pre>

                                    <p>在解决了问题之后，我再上Firefox浏览器去上传图片就成功了！</p>

                                    <p><img src="http://img.blog.csdn.net/20170610204014096?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQva2VzaXhpbg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" class="img-responsive"></p>
                                </div>
                                <div class="col-lg-4 animate-box">
                                    <div class="gtco-highlight right">
                                        <h4>点点滴滴</h4>
                                        <p style="font-size:15px;">起初就把事情做對是完全沒必要的。但最後要把事情做對是絕對必要的。(Andrew Hunt and David Thomas)</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </article>
                </div>
            </div>
        </div>
    </div>



    <footer id="gtco-footer" role="contentinfo" style="padding:0;">
        <div class="container">
            <div class="row copyright">
                <div class="col-md-12 text-center">
                    <p>
                        <span style="font-size:16px;">©</span>2017 版权所有 ICP证：<a href="http://www.miitbeian.gov.cn/" target="_block" style="color:#666666">粤ICP备17112246号</a>
                    </p>
                </div>
            </div>

        </div>
    </footer>
</div>

<div class="gototop js-top">
    <a href="#" class="js-gotop"><i class="icon-arrow-up"></i></a>
</div>

<!-- jQuery -->
<script src="../../js/jquery.min.js"></script>
<!-- jQuery Easing -->
<script src="../../js/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="../../js/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="../../js/jquery.waypoints.min.js"></script>
<!-- Stellar -->
<script src="../../js/jquery.stellar.min.js"></script>
<!-- Main -->
<script src="../../js/main.js"></script>

</body>
</html>

